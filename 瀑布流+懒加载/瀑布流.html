<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>瀑布流text</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
</head>

<style type="text/css">
  *{margin:0;padding:0}
  a{text-decoration:none;}
  ul li{list-style:none;}
  .warpped{
    position: relative;
    /*overflow: hidden;*/
  }
  .item{
    position: absolute;/*位置*/
    width:200px;/*大小*/
    margin-top: 10px;
    margin-left:10px;
    transition:all 1s;
  }
  .h1{
    height:200px;
    background-color: blue;
  }
  .h2{
    height: 280px;
    background-color: green;
  }
  .h3{
    height: 350px;
    background-color:yellow;
  }
</style>

<body>
    <div class="warpped">
        <div class="item h1">1</div>
        <div class="item h2">2</div>
        <div class="item h3">3</div>
        <div class="item h1">1</div>
        <div class="item h2">2</div>
        <div class="item h3">3</div>
        <div class="item h1">1</div>
        <div class="item h2">2</div>
        <div class="item h3">3</div>
        <div class="item h1">1</div>
        <div class="item h2">2</div>
        <div class="item h3">3</div>   
        <div class="item h1">1</div>
        <div class="item h2">2</div>
        <div class="item h3">3</div>
        <div class="item h1">1</div>
        <div class="item h2">2</div>
        <div class="item h3">3</div>      
    </div>
<script src="http://apps.bdimg.com/libs/jquery/1.9.1/jquery.js"></script>
<script type="text/javascript">
  
  var waterfall = (function(){//立即执行函数
      function init(){
          var winWidth = $(window).width();//窗口宽度，现时是父容器宽度
          var itemWidth = $('.item').outerWidth(true);//盒子宽度（包含外边距+边框）
          var culNum = Math.floor(winWidth/itemWidth);//一行可以放的列数
          //console.log(culNum)
          
          var colHeight = [];

          for(i=0; i<culNum; i++){
            console.log(colHeight)
            colHeight.push(0)
            console.log(colHeight)//[0:840;1:940;2:1010;3:790;4:860;5:720]
          }
          
          $('.item').each(function(){//遍历盒子的高度，找出盒子中最矮的。关键：摆放每一个元素总是放到各列总高度最小的列下
            //console.log(this)
          var $cur = $(this)
          
          var minHeight = colHeight[0]
          var index = 0//这一步想了好久，index必须等于0,为了到5的时候停止又返回0
          for(j=0; j<colHeight.length; j++){ 
            if (colHeight[j]<minHeight) {
              minHeight = colHeight[j]
              index = j
            }
          }
          console.log(index)//0,1,2,3,4,5   0,1,2,3,4,5  0,1,2,3,4,5

           $cur.css({//设置位置：绝对定位
            left:index*itemWidth,
            top:minHeight
           })


            colHeight[index] = colHeight[index]+$cur.outerHeight(true)
            console.log(colHeight)
          })
      }

    return{
      init:init//暴露出一个接口
    }

  })()

  $(window).on('resize',function(){
    waterfall.init()
  })
  waterfall.init()

</script>
</body>
</html>