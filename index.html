<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>懒加载</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
</head>

<style type="text/css">
  *{margin:0;padding:0}
  a{text-decoration:none;}
  ul li{list-style:none;}
  .warpped{
    position: relative;
    /*overflow: hidden;*/
  }
  .item{
    position: absolute;/*位置*/
    width:250px;/*大小*/
    margin-top: 10px;
    margin-left:20px;
    box-shadow: 1px 1px 10px rgba(0,0,0,.2);
    transition:all 1s;
  }
  .h1{
    height:200px;
 	text-align: center;
  }
  .h2{
    height: 280px;
    text-align: center;
  }
  .h3{
    height: 350px;
    text-align: center;
  }
  img{
  	width:100%;
  	height: 100%;
  }
</style>

<body>
    <div class="warpped">
        <div class="item h1"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img03.tooopen.com/images/20160629/tooopen_sy_168249847294.jpg" alt=""></div>
        <div class="item h2"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img02.tooopen.com/images/20160601/tooopen_sy_163933439186.jpg" alt=""></div>
        <div class="item h3"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img02.tooopen.com/images/20160621/tooopen_sy_165840127198.jpg" alt=""></div>
        <div class="item h1"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img02.tooopen.com/images/20160330/tooopen_sy_157795262551.jpg"></div>
        <div class="item h2"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img06.tooopen.com/products/20160712/tooopen_71876368.jpg" alt=""></div>
        <div class="item h3"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img02.tooopen.com/images/20151019/tooopen_sy_145700437111.jpg" alt=""></div>
        <div class="item h1"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img06.tooopen.com/products/20160712/tooopen_91297425.jpg" alt=""></div>
        <div class="item h2"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img06.tooopen.com/products/20160712/tooopen_18219676.jpg" alt=""></div>
        <div class="item h3"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img06.tooopen.com/images/20160712/tooopen_sy_170169718399.jpg" alt=""></div>   
        <div class="item h1"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img02.tooopen.com/images/20160608/tooopen_sy_164582848729.jpg" alt=""></div>
        <div class="item h2"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img02.tooopen.com/images/20151226/tooopen_sy_152835944639.jpg" alt=""></div>
        <div class="item h3"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img05.tooopen.com/images/20150906/tooopen_sy_141560868431.jpg" alt=""></div>
        <div class="item h1"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img05.tooopen.com/images/20150817/tooopen_sy_138579512463.jpg" alt=""></div>
        <div class="item h2"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img05.tooopen.com/images/20150326/tooopen_sy_83625324232.jpg" alt=""></div>
        <div class="item h3"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img05.tooopen.com/images/20150122/sy_79672329748.jpg" alt=""></div> 
        <div class="item h1"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img05.tooopen.com/images/20140911/sy_70460413661.jpg" alt=""></div>
        <div class="item h2"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img05.tooopen.com/images/20140903/sy_70095789643.jpg" alt=""></div>   
        <div class="item h3"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img03.tooopen.com/images/20160701/tooopen_sy_168544222482.jpg" alt=""></div>   
        <div class="item h1"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img02.tooopen.com/images/20160506/tooopen_sy_161741199875.jpg" alt=""></div>   
        <div class="item h2"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://img02.tooopen.com/images/20151222/tooopen_sy_152375696216.jpg" alt=""></div>   
        <div class="item h3"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://static.gicpic.cn/html/gettyback/images1/20160324/1_20160324100339_3e0gb.jpg" alt=""></div>
        <div class="item h1"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://pic2.desk.chinaz.com/file/201212/5/jialebihaia7.jpg" alt=""></div>  
        <div class="item h2"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://g.hiphotos.baidu.com/zhidao/pic/item/cc11728b4710b9126678dba3c1fdfc0392452235.jpg" alt=""></div>  
        <div class="item h3"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://g.hiphotos.baidu.com/zhidao/pic/item/1ad5ad6eddc451da5711c5ebb0fd5266d11632cf.jpg" alt=""></div>  
        <div class="item h1"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://dl.bizhi.sogou.com/images/2013/03/26/334124.jpg" alt=""></div>  
        <div class="item h2"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://a.hiphotos.baidu.com/zhidao/pic/item/0ff41bd5ad6eddc4f995afa438dbb6fd5266337a.jpg" alt=""></div>  
        <div class="item h3"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://www.bz55.com/uploads/allimg/130516/1-130516160615.jpg" alt=""></div>  
        <div class="item h1"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://tupian.enterdesk.com/2013/xll/007/09/06/1.jpg" alt=""></div>
        <div class="item h2"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://image.tianjimedia.com/uploadImages/2012/004/O5M4I890VRR6.jpg" alt=""></div> 
        <div class="item h3"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://p4.image.hiapk.com/uploads/allimg/140611/7730-140611145644.jpg" alt=""></div>   
        <div class="item h1"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://m2.quanjing.com/2m/glow004/gwp107045.jpg" alt=""></div>        
        <div class="item h2"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://tupian.enterdesk.com/2013/xll/012/05/10/7.jpg" alt=""></div>
        <div class="item h3"><img src="http://img.ui.cn/data/file/4/5/9/209954.gif" data-src="http://dl.bizhi.sogou.com/images/2012/02/18/52291.jpg" alt=""></div> 
    </div>
<script src="http://apps.bdimg.com/libs/jquery/1.9.1/jquery.js"></script>

<script type="text/javascript">
  
  var waterfall = (function(){//立即执行函数
      function init(){
          var winWidth = $(window).width();//窗口宽度，现时是父容器宽度
          var itemWidth = $('.item').outerWidth(true);//盒子宽度（包含外边距+边框）
          var culNum = Math.floor(winWidth/itemWidth);//一行可以放的列数
          //console.log(culNum)
          
          var colHeight = [];

          for(i=0; i<culNum; i++){
            colHeight.push(0)
            // console.log(colHeight)//[0:840;1:940;2:1010;3:790;4:860;5:720]
          }
          
          $('.item').each(function(){//遍历盒子的高度，找出盒子中最矮的。关键：摆放每一个元素总是放到各列总高度最小的列下
            //console.log(this)
          var $cur = $(this)
          
          var minHeight = colHeight[0]
          var index = 0//这一步想了好久，index必须等于0,为了到5的时候停止又返回0
          for(j=0; j<colHeight.length; j++){ 
            if (colHeight[j]<minHeight) {
              minHeight = colHeight[j]
              index = j
            }
          }
          // console.log(index)//0,1,2,3,4,5   0,1,2,3,4,5  0,1,2,3,4,5

           $cur.css({//设置位置：绝对定位
            left:index*itemWidth,
            top:minHeight
           })

            colHeight[index] = colHeight[index]+$cur.outerHeight(true)
            // console.log(colHeight)
          })
      	}

	    return{
	      init:init//暴露出一个接口
	    }

  	})()

	  $(window).on('resize',function(){
	    waterfall.init()
	  })
	  waterfall.init()



//下面代码：懒加载效果

// 步骤一：遍历全部的元素,
// 步骤二：当每一个元素在scroll滚动的情况下，去观察每一元素，只要是做了过滤标记的都不要再观察了
// 步骤三：当有元素是在(scrollH +winH) > Top的条件下，证明有元素在可视范围之内
// 步骤四：在可视范围内就把src改成data-src，并把它加上过滤标签



function checkShow($node){
	var $img = $('.warpped img');
	$img.each(function(){
		if($(this).attr('isLoaded')) return;
		
		var scrollH = $(window).scrollTop();//页面顶部距离窗口顶部的滚动距离
		var	winH = $(window).height();//浏览器页面的高度
		var	thisTop = $(this).offset().top;//元素距画卷的顶部距离
			console.log(thisTop)
			if((scrollH +winH) > thisTop){
				showImg($(this))
		}
	})
}
checkShow($('.warpped img'))


function showImg($panel){//在展示图片的同时该处理什么
	var dataSrc = $panel.attr('data-src');
		$panel.attr('src', dataSrc)
		$panel.attr('isLoaded', true)
}

</script>
</body>
</html>